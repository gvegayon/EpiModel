#!/usr/bin/env Rscript

# Minimal EpiModel Benchmarking Script
# For performance testing with minimal complexity
# Generated by: GitHub Copilot (Claude Sonnet 4)
# Date: July 16, 2025
# Purpose: Minimal baseline benchmark for EpiModel netsim performance

library(EpiModel)

# Set seed for reproducibility
set.seed(12345)

cat("Starting minimal EpiModel benchmark...\n")
cat("Network: 1000 nodes, 30 days, 10 sims\n\n")

start_time <- Sys.time()

# 1. Simple network initialization
nw <- network_initialize(n = 1000)

# 2. Simplest possible formation model (edges only)
formation <- ~edges
target.stats <- 500  # ~0.1% density
coef.diss <- dissolution_coefs(dissolution = ~offset(edges), duration = 20)

# 3. Estimate network model
cat("Estimating network model...\n")
est <- netest(nw, formation, target.stats, coef.diss, verbose = FALSE)

# 4. Set epidemic parameters
param <- param.net(inf.prob = 0.3, act.rate = 0.5)
init <- init.net(i.num = 10)
control <- control.net(type = "SI", nsteps = 30, nsims = 10, 
                       resimulate.network = TRUE, tergmLite = TRUE, 
                       verbose = FALSE)

# 5. Run simulation and time it
cat("Running simulation...\n")
sim_start <- Sys.time()
mod <- netsim(est, param, init, control)
sim_end <- Sys.time()

total_time <- sim_end - start_time
sim_time <- sim_end - sim_start

# Results
cat("\n=== BENCHMARK RESULTS ===\n")
cat(sprintf("Total time: %.2f seconds\n", as.numeric(total_time, units = "secs")))
cat(sprintf("Simulation time: %.2f seconds\n", as.numeric(sim_time, units = "secs")))
cat(sprintf("Time per sim: %.3f seconds\n", as.numeric(sim_time, units = "secs") / 10))

cat("\nFinal infections:", sum(mod$epi$i.num[31, ], na.rm = TRUE), "\n")
cat("Benchmark completed!\n")
